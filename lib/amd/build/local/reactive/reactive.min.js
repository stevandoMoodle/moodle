define("core/local/reactive/reactive",["exports","core/log","core/local/reactive/statemanager","core/pending"],(function(_exports,_log,_statemanager,_pending){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_log=_interopRequireDefault(_log),_statemanager=_interopRequireDefault(_statemanager),_pending=_interopRequireDefault(_pending);var pendingCount=0,_default=function(){function _default(description){var _description$target,_description$mutation;if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,_default),void 0===description.eventName||void 0===description.eventDispatch)throw new Error("Reactivity event required");void 0!==description.name&&(this.name=description.name),this.target=null!==(_description$target=description.target)&&void 0!==_description$target?_description$target:document.createTextNode(null),this.eventName=description.eventName,this.eventDispatch=description.eventDispatch,this.stateManager=new _statemanager.default(this.eventDispatch,this.target),this.watchers=new Map([]),this.components=new Set([]),this.mutations=null!==(_description$mutation=description.mutations)&&void 0!==_description$mutation?_description$mutation:{},this.target.addEventListener(this.eventName,this.callWatchersHandler.bind(this)),this.pendingState=new _pending.default("core/reactive:registerInstance".concat(pendingCount++)),void 0!==description.state&&this.setInitialState(description.state),void 0!==M.reactive&&M.reactive.registerNewInstance(this)}var Constructor,protoProps,staticProps,fn,_dispatch;return Constructor=_default,protoProps=[{key:"callWatchersHandler",value:function(event){this.target.dispatchEvent(new CustomEvent(event.detail.action,{bubbles:!1,detail:event.detail}))}},{key:"setInitialState",value:function(stateData){this.pendingState.resolve(),this.stateManager.setInitialState(stateData)}},{key:"addMutations",value:function(newFunctions){void 0!==newFunctions.init&&newFunctions.init(this.stateManager);for(var _i=0,_Object$entries=Object.entries(newFunctions);_i<_Object$entries.length;_i++){var _Object$entries$_i=_slicedToArray(_Object$entries[_i],2),mutation=_Object$entries$_i[0],mutationFunction=_Object$entries$_i[1];this.mutations[mutation]=mutationFunction.bind(newFunctions)}}},{key:"setMutations",value:function(manager){this.mutations=manager,void 0!==manager.init&&manager.init(this.stateManager)}},{key:"state",get:function(){return this.stateManager.state}},{key:"get",value:function(name,id){return this.stateManager.get(name,id)}},{key:"getInitialStatePromise",value:function(){return this.stateManager.getInitialPromise()}},{key:"registerComponent",value:function(component){var _component$name,_this=this,componentName=null!==(_component$name=component.name)&&void 0!==_component$name?_component$name:"Unkown component",dispatchSuccess=function(){},dispatchFail=dispatchSuccess;if(void 0!==component.dispatchRegistrationSuccess&&(dispatchSuccess=component.dispatchRegistrationSuccess.bind(component)),void 0!==component.dispatchRegistrationFail&&(dispatchFail=component.dispatchRegistrationFail.bind(component)),this.components.has(component))return dispatchSuccess(),component;var pendingPromise=new _pending.default("core/reactive:registerComponent".concat(pendingCount++)),listeners=[],handlers=[];return void 0!==component.getWatchers&&(handlers=component.getWatchers()),handlers.forEach((function(_ref){var watch=_ref.watch,handler=_ref.handler;if(void 0===watch)throw dispatchFail(),new Error("Missing watch attribute in ".concat(componentName," watcher"));if(void 0===handler)throw dispatchFail(),new Error("Missing handler for watcher ".concat(watch," in ").concat(componentName));var listener=function(event){var currentFocus=document.activeElement;handler.apply(component,[event.detail]),document.activeElement===document.body&&document.body.contains(currentFocus)&&currentFocus.focus()};listeners.push({target:_this.target,watch:watch,listener:listener}),_this.target.addEventListener(watch,listener)})),void 0!==component.stateReady&&this.getInitialStatePromise().then((function(state){return component.stateReady(state),pendingPromise.resolve(),!0})).catch((function(reason){pendingPromise.resolve(),_log.default.error("Initial state in ".concat(componentName," rejected due to: ").concat(reason)),_log.default.error(reason)})),this.watchers.set(component,listeners),this.components.add(component),this.target.dispatchEvent(new CustomEvent("registerComponent:success",{bubbles:!1,detail:{component:component}})),dispatchSuccess(),component}},{key:"unregisterComponent",value:function(component){if(!this.components.has(component))return component;this.components.delete(component);var listeners=this.watchers.get(component);return void 0===listeners||(listeners.forEach((function(_ref2){var target=_ref2.target,watch=_ref2.watch,listener=_ref2.listener;target.removeEventListener(watch,listener)})),this.watchers.delete(component)),component}},{key:"dispatch",value:(fn=regeneratorRuntime.mark((function _callee(actionName){var pendingPromise,mutationFunction,_len,params,_key,_args=arguments;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if("string"==typeof actionName){_context.next=2;break}throw new Error("Dispatch action name must be a string");case 2:if("_"!==actionName.charAt(0)){_context.next=4;break}throw new Error("Illegal Private ".concat(actionName," mutation method dispatch"));case 4:if(void 0!==this.mutations[actionName]){_context.next=6;break}throw new Error("Unkown ".concat(actionName," mutation"));case 6:for(pendingPromise=new _pending.default("core/reactive:".concat(actionName).concat(pendingCount++)),mutationFunction=this.mutations[actionName],_context.prev=8,_len=_args.length,params=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)params[_key-1]=_args[_key];return _context.next=12,mutationFunction.apply(this.mutations,[this.stateManager].concat(params));case 12:pendingPromise.resolve(),_context.next=20;break;case 15:throw _context.prev=15,_context.t0=_context.catch(8),this.stateManager.setReadOnly(!0),pendingPromise.resolve(),_context.t0;case 20:case"end":return _context.stop()}}),_callee,this,[[8,15]])})),_dispatch=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x){return _dispatch.apply(this,arguments)})}],protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),_default}();return _exports.default=_default,_exports.default}));

//# sourceMappingURL=reactive.min.js.map