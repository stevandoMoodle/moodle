define("tiny_media/usedfiles",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;_exports.init=function(files,usercontext,itemid){!function(files,usercontext,itemid){var CSS_HASMISSINGFILES="has-missing-files",CSS_HASUNUSEDFILES="has-unused-files",SELECTORS_FILEANCESTOR=".fitem",SELECTORS_FORM="#tiny_mediamanager_form",SELECTORS_MISSINGFILES=".missing-files",_files=files,_usercontext=usercontext,_itemid=itemid,form=document.querySelector(SELECTORS_FORM),usedFiles=function(){for(var content=window.parent.document.getElementById("id_description_editor_ifr").contentWindow.document.getElementById("tinymce"),baseUrl="".concat(M.cfg.wwwroot,"/draftfile.php/").concat(_usercontext,"/user/draft/").concat(_itemid,"/"),pattern=new RegExp("[\"']"+baseUrl.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")+"(.+?)[\\?\"']","gm"),match="",usedFiles={};null!==(match=pattern.exec(content.innerHTML));)usedFiles[decodeURIComponent(match[1])]=!0;return usedFiles}(),unusedFiles=function(allFiles,usedFiles){var key,list=[];for(key in allFiles)usedFiles[key]||list.push(key);return list}(_files,usedFiles),missingFiles=function(allFiles,usedFiles){var key,list=[];for(key in usedFiles)allFiles[key]||list.push(key);return list}(_files,usedFiles),missingFilesTxt=null,i=null;if(form&&window.parent)if(unusedFiles.length>0?(form.querySelectorAll('input[type=checkbox][name^="deletefile"]').forEach((function(node){-1===unusedFiles.indexOf(node.getAttribute("data-filename"))&&node.closest(SELECTORS_FILEANCESTOR).remove()})),form.classList.add(CSS_HASUNUSEDFILES)):form.classList.remove(CSS_HASUNUSEDFILES),missingFiles.length>0){for(missingFilesTxt="<ol>",i=0;i<missingFiles.length;i++)missingFilesTxt+="<li>".concat(missingFiles[i].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),"</li>");missingFilesTxt+="</ol>",form.querySelector(SELECTORS_MISSINGFILES).innerHTML=missingFilesTxt,form.classList.add(CSS_HASMISSINGFILES)}else form.classList.remove(CSS_HASMISSINGFILES);else window.console.log("Unable to find parent window")}(files,usercontext,itemid)}}));

//# sourceMappingURL=usedfiles.min.js.map