define("tiny_bibliography/bibliography/bibliography",["exports","core/modal_factory","core/modal_events","core/str","../common","./setter","./example","./templateloader","./helper"],(function(_exports,Modal,ModalEvents,_str,_common,_setter,_example,_templateloader,_helper){var obj;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,Modal=_interopRequireWildcard(Modal),ModalEvents=_interopRequireWildcard(ModalEvents),_setter=(obj=_setter)&&obj.__esModule?obj:{default:obj};class Bibliography extends _setter.default{constructor(editor){super(),_defineProperty(this,"resetBibliographyContainerHeight",(()=>{const form=(0,_helper.byId)("bibliography-info-holder"),bibliographyContainer=(0,_helper.byId)("bibliography-info-list-holder");bibliographyContainer.style.height="0px",bibliographyContainer&&(bibliographyContainer.style.height="".concat(form.offsetHeight-15,"px"),(0,_helper.showElement)(["bibliography-info-list-holder"]))})),_defineProperty(this,"addKeyupListeners",(()=>{const element=this.modal.getRoot()[0],handler=this.createKeyupListenerHandler.bind(null);element.addEventListener("keyup",handler),this.attachedKeyupEventListener.push([element,handler,"keyup"])})),_defineProperty(this,"createKeyupListenerHandler",(event=>{const exampleNodes=event.target.closest('[data-type="bibliography-info-example"]');exampleNodes&&(this.allData[exampleNodes.dataset.name]=exampleNodes.value,"true"===exampleNodes.dataset.author&&this.splitAuthorName(exampleNodes.dataset.name))})),_defineProperty(this,"removeAttachedKeyupListeners",(()=>{this.attachedKeyupEventListener.forEach((listener=>{const[element,handler,even]=listener;element.removeEventListener(even,handler)})),this.attachedKeyupEventListener=[]})),_defineProperty(this,"addChangeListeners",(()=>{const element=this.modal.getRoot()[0],handler=this.createChangeListenerHandler.bind(null);element.addEventListener("change",handler),this.attachedChangeEventListener.push([element,handler,"change"])})),_defineProperty(this,"createChangeListenerHandler",(event=>{const exampleNodes=event.target.closest('[data-type="style-source"]');if(exampleNodes){this["set".concat((0,_helper.ucFirst)(exampleNodes.dataset.name))](exampleNodes.value)}})),_defineProperty(this,"removeAttachedChangeListeners",(()=>{this.attachedChangeEventListener.forEach((listener=>{const[element,handler,even]=listener;element.removeEventListener(even,handler)})),this.attachedChangeEventListener=[]})),_defineProperty(this,"addClickListeners",(()=>{const element=this.modal.getRoot()[0],handler=this.createClickListenerHandler.bind(null);element.addEventListener("click",handler),this.attachedClickEventListener.push([element,handler,"click"])})),_defineProperty(this,"createClickListenerHandler",(event=>{this.setCustomAuthorNames(event);event.target.closest('[data-action="generate-list"]')&&this.selectedStyle.generateBibliography(this);const optionalFields=event.target.closest('[data-action="show-other-fields"]');optionalFields&&(this.allData.showOtherFields=optionalFields.checked,this.setSource(this.allData.source));event.target.closest('[data-action="cite-this"]')&&this.selectedStyle.citeThis(this,event);event.target.closest('[data-action="delete-bio"]')&&this.selectedStyle.deleteBibliography(this,event);const editBio=event.target.closest('[data-action="edit-bio"]');editBio&&this.selectedStyle.editBibliography(this,editBio)})),_defineProperty(this,"removeAttachedClickListeners",(()=>{this.attachedClickEventListener.forEach((listener=>{const[element,handler,even]=listener;element.removeEventListener(even,handler)})),this.attachedClickEventListener=[]})),_defineProperty(this,"generateBioAndDisplayInModal",(()=>{let bioList=this.editor.dom.select('[class="id-bibliography-holder"]');if(bioList.length>0){let nodes=(0,_helper.byId)("bibliography-info-list-holder"),index=1;nodes.innerHTML="",bioList[0].childNodes.forEach((async node=>{let newNode;if("DIV"===node.nodeName&&""!==node.textContent.trim()){let textContent="";textContent="SPAN"!==node.firstChild.nodeName?node.childNodes[1].innerHTML.replaceAll('" "','"'):node.firstChild.innerHTML.replaceAll('" "','"'),newNode=await(0,_templateloader.getBioListWithButtons)({id:node.getAttribute("class"),last:index===bioList[0].childNodes.length-1,index:index++,dataObject:"{".concat(textContent,"}"),bio:node.innerHTML.trim(),heading:!1})}else"H3"===node.nodeName&&""!==node.textContent.trim()&&(newNode=await(0,_templateloader.getBioListWithButtons)({id:node.getAttribute("class"),bio:node.innerHTML.trim(),heading:!0}));newNode&&(nodes.innerHTML+=newNode)}))}})),this.editor=editor,this.modal=null,this.allData={},this.selectedSource=null,this.selectedStyle=null,this.fields=[],this.create=!0,this.updateId=null,this.updateIndex=null,this.attachedClickEventListener=[],this.attachedChangeEventListener=[],this.attachedKeyupEventListener=[],this.initSetter()}destroy(){delete this.editor,this.modal.destroy(),delete this.modal}async displayDialogue(){const sources=await(0,_helper.getSourceLangString)(this.selectedStyle.ALL_SOURCES);this.modal=await Modal.create({type:Modal.types.DEFAULT,large:!0,title:(0,_str.get_string)("pluginname",_common.component),body:(0,_templateloader.getDialogueContent)(sources)}),this.modal.getRoot().on(ModalEvents.hidden,(()=>this.destroy())),this.modal.getRoot().on(ModalEvents.bodyRendered,(async()=>{this.generateBioAndDisplayInModal(),(0,_example.getExample)(),await this.setSource()})),this.modal.show()}}return _exports.default=Bibliography,_exports.default}));

//# sourceMappingURL=bibliography.min.js.map