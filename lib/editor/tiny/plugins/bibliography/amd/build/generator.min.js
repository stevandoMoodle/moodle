define("tiny_bibliography/generator",["exports","core/templates","core/str","./common","./formsetter","core/modal_factory","core/modal_events","./getter","./bibliography"],(function(_exports,_templates,_str,_common,_formsetter,Modal,ModalEvents,Getter,Bibliography){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/*
   * @package    tiny_bibliography
   * @copyright  2023 Stevani Andolo  <stevani@hotmail.com.au>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_templates=_interopRequireDefault(_templates),_formsetter=_interopRequireDefault(_formsetter),Modal=_interopRequireWildcard(Modal),ModalEvents=_interopRequireWildcard(ModalEvents),Getter=_interopRequireWildcard(Getter),Bibliography=_interopRequireWildcard(Bibliography);class Generator extends _formsetter.default{constructor(editor){super(),this.editor=editor,this.modal=null,this.style="IEEE",this.source="Book",this.allsources={"Article in journal":"Journal name",Book:"Publisher"},this.pureauthor=null,this.author="",this.title=null,this.city=null,this.purecity=null,this.publisher=null,this.year=null,this.volume=null,this.issue=null,this.pages=null,this.create=!0,this.updateid=null,this.updateindex=null,this.reorderfrom=null}destroy(){delete this.editor,this.modal.destroy(),delete this.modal}async displayDialogue(){this.modal=await Modal.create({type:Modal.types.DEFAULT,large:!0,title:(0,_str.get_string)("pluginname",_common.component),body:this.getDialogueContent()}),this.modal.getRoot().on(ModalEvents.hidden,(()=>this.destroy())),this.modal.getRoot().on(ModalEvents.bodyRendered,(()=>{Bibliography.generateBioAndDisplayInModal(this),Getter.getExampleManually()})),this.modal.getRoot()[0].addEventListener("click",(async event=>{Getter.getExample(event),this.setCustomAuthorNames(event);event.target.closest('[data-action="generate-list"]')&&Bibliography.generateBibliography(this),Bibliography.citeThis(this,event),Bibliography.deleteBibliography(this,event),Bibliography.editBibliography(this,event)})),this.modal.getRoot()[0].addEventListener("change",(event=>{const exampleNodes=event.target.closest('[data-type="style-source"]');if(exampleNodes){const variable=exampleNodes.dataset.name.replaceAll("_","");this["set".concat(variable.charAt(0).toUpperCase()+variable.slice(1))](exampleNodes.value)}})),this.modal.getRoot()[0].addEventListener("keyup",(event=>{const exampleNodes=event.target.closest('[data-type="bibliography-info-example"]');if(exampleNodes){const variable=exampleNodes.dataset.name.replaceAll("_","");this["set".concat(variable.charAt(0).toUpperCase()+variable.slice(1))](exampleNodes.value)}})),this.modal.show()}splitAuthorName(){const data=this.pureauthor;if(data)if(!0===data.includes(";")){data.split(";").forEach((author=>{""!==(author=author.trim())&&this.setGeneratedAuthorNames(this.generateDetailedAuthorName(author))}))}else this.setGeneratedAuthorNames(this.generateDetailedAuthorName(data))}generateDetailedAuthorName(){let author=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,surename="",firstname="",middlename="";if(author.includes(",")){const names=author.split(",");surename=names[0];let fmname=names[1];if(fmname.includes(" ")){fmname=fmname.split(" ");let i=0;fmname.forEach((fm=>{""!==fm&&(0===i?firstname=fm:middlename+=fm+" ",i++)}))}else firstname=fmname}else firstname=author;return this.generateAuthorName(firstname.trim(),middlename.trim(),surename.trim()).generated}generateAuthorName(){let firstname=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,middlename=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,surename=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null!==firstname){var _surename,_middlename;const gensurename=surename?surename.charAt(0).toUpperCase()+surename.slice(1):"";surename=surename?surename+", ":null;let genmiddlename="",genfirstname="";return surename?(genmiddlename=middlename?middlename.charAt(0).toUpperCase()+". ":"",middlename=middlename?middlename+"":null):(genmiddlename=middlename?middlename.charAt(0).toUpperCase():"",middlename=middlename||null),surename||middlename?(genfirstname=firstname?firstname.charAt(0).toUpperCase()+". ":"",firstname=firstname?firstname+" ":""):(genfirstname=firstname?firstname.charAt(0).toUpperCase():"",firstname=firstname||""),{generated:genfirstname+genmiddlename+gensurename,originated:(null!==(_surename=surename)&&void 0!==_surename?_surename:", ")+firstname+(null!==(_middlename=middlename)&&void 0!==_middlename?_middlename:"")}}return null}getTextNodes(node,nodeType,result){var children=node.childNodes;nodeType=nodeType||3,result=result||[];node.nodeType==nodeType&&result.push(node);for(var i=0;i<children.length;i++)result=this.getTextNodes(children[i],nodeType,result);return result}async getDialogueContent(){return _templates.default.render("tiny_bibliography/bibliography_form",{warnings:[]})}async getBioContent(data){return _templates.default.render("tiny_bibliography/bibliography_content",{...data})}async getBioListWithButtons(data){return _templates.default.render("tiny_bibliography/bibliography_list_with_buttons",{...data})}checkSource(){let source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.source===source}}return _exports.default=Generator,_exports.default}));

//# sourceMappingURL=generator.min.js.map