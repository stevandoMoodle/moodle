{"version":3,"file":"manager.min.js","sources":["../src/manager.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tiny Media Manager plugin class for Moodle.\n *\n * @module      tiny_mediamanager/image\n * @copyright   2022 Stevani Andolo <stevani@hotmail.com.au>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {get_string as getString} from 'core/str';\nimport * as Modal from 'core/modal_factory';\nimport * as ModalEvents from 'core/modal_events';\nimport {getData} from './options';\n\nexport const MediaManager = class {\n\n    editor = null;\n    area = null;\n    CAN_RECEIVE_FOCUS_SELECTOR = '.fp-navbar a:not([disabled])';\n    FILE_MANAGER_SELECTOR = '#fitem_id_files_filemanager';\n\n    constructor(editor) {\n        this.editor = editor;\n        const data = getData(editor);\n        this.area = data.params.area;\n        this.area.itemid = data.fpoptions.image.itemid;\n    }\n\n    displayDialogue() {\n        const iframe = document.createElement('iframe');\n        // We set the height here because otherwise it is really small. That might not look\n        // very nice on mobile \"devices, but we considered that enough for now.\n        iframe.style.cssText = `\n            height: 650px;\n            border: none;\n            width: 100%;\n        `;\n        iframe.setAttribute('src', this._getIframeURL());\n\n        // Focus on the first focusable element of the file manager after it is fully loaded.\n        iframe.addEventListener('load', function() {\n            // The file manager component is loaded asynchronously after the page is loaded.\n            // We check for the presence of .fm-loaded every 200 ms to determine if the file manager is loaded yet.\n            var intervalId = setInterval(function() {\n                if (document.querySelector('.fm-loaded')) {\n                    var firstFocusableElement = document.querySelector(this.CAN_RECEIVE_FOCUS_SELECTOR);\n                    if (firstFocusableElement) {\n                        firstFocusableElement.focus();\n                    }\n                    clearInterval(intervalId);\n                }\n            }, 200);\n        }, this, iframe);\n\n        Modal.create({\n            type: Modal.types.DEFAULT,\n            large: true,\n            title: getString('mediamanagerproperties', 'tiny_mediamanager'),\n            body: iframe\n        }).then(modal => {\n            modal.getRoot().on(ModalEvents.hidden, () => {\n                modal.destroy();\n            });\n            modal.show();\n            document.querySelector('.modal-lg').style.cssText = `max-width: 850px`;\n            return modal;\n        }).catch();\n    }\n\n    _getIframeURL = () => {\n        const args = new URLSearchParams({\n            elementid: this.editor.getElement().id,\n            ...this.area\n        });\n        return M.cfg.wwwroot + '/lib/editor/tiny/plugins/mediamanager/manage.php?' + args.toString();\n    };\n};\n"],"names":["MediaManager","editor","args","URLSearchParams","elementid","_this","getElement","id","area","M","cfg","wwwroot","toString","data","params","itemid","fpoptions","image","iframe","document","createElement","style","cssText","setAttribute","this","_getIframeURL","addEventListener","intervalId","setInterval","querySelector","firstFocusableElement","CAN_RECEIVE_FOCUS_SELECTOR","focus","clearInterval","Modal","create","type","types","DEFAULT","large","title","body","then","modal","getRoot","on","ModalEvents","hidden","destroy","show","catch"],"mappings":"wwEA4BaA,8CAOGC,wMALH,kCACF,wDACsB,6EACL,qEAkDR,eACNC,KAAO,IAAIC,8cACbC,UAAWC,MAAKJ,OAAOK,aAAaC,IACjCF,MAAKG,cAELC,EAAEC,IAAIC,QAAU,oDAAsDT,KAAKU,mBApD7EX,OAASA,WACRY,MAAO,oBAAQZ,aAChBO,KAAOK,KAAKC,OAAON,UACnBA,KAAKO,OAASF,KAAKG,UAAUC,MAAMF,wHAG5C,eACUG,OAASC,SAASC,cAAc,UAGtCF,OAAOG,MAAMC,sGAKbJ,OAAOK,aAAa,MAAOC,KAAKC,iBAGhCP,OAAOQ,iBAAiB,QAAQ,eAGxBC,WAAaC,aAAY,cACrBT,SAASU,cAAc,cAAe,KAClCC,sBAAwBX,SAASU,cAAcL,KAAKO,4BACpDD,uBACAA,sBAAsBE,QAE1BC,cAAcN,eAEnB,OACJH,KAAMN,QAETgB,MAAMC,OAAO,CACTC,KAAMF,MAAMG,MAAMC,QAClBC,OAAO,EACPC,OAAO,mBAAU,yBAA0B,qBAC3CC,KAAMvB,SACPwB,MAAK,SAAAC,cACJA,MAAMC,UAAUC,GAAGC,YAAYC,QAAQ,WACnCJ,MAAMK,aAEVL,MAAMM,OACN9B,SAASU,cAAc,aAAaR,MAAMC,2BACnCqB,SACRO"}