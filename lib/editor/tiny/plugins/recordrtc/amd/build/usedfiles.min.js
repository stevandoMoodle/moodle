define("tiny_recordrtc/usedfiles",["exports"],(function(_exports){function _readOnlyError(name){throw new TypeError('"'+name+'" is read-only')}
/**
   * Tiny Media configuration.
   *
   * @module      tiny_mediamanager/usedfiles
   * @copyright   2022 Stevani Andolo <stevani@hotmail.com.au>
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;_exports.init=function(files,usercontext,itemid){!function(files,usercontext,itemid){var CSS_HASMISSINGFILES="has-missing-files",CSS_HASUNUSEDFILES="has-unused-files",SELECTORS_FILEANCESTOR=".fitem",SELECTORS_FORM="#tiny_mediamanager_form",SELECTORS_MISSINGFILES=".missing-files",_files=files,_usercontext=usercontext,_itemid=itemid,form=document.querySelector(SELECTORS_FORM),usedFiles=function(){for(var content=window.parent.document.getElementById("id_description_editor_ifr").contentWindow.document.getElementById("tinymce"),baseUrl="".concat(M.cfg.wwwroot,"/draftfile.php/").concat(_usercontext,"/user/draft/").concat(_itemid,"/"),pattern=new RegExp("[\"']"+baseUrl.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")+"(.+?)[\\?\"']","gm"),match="",usedFiles={};null!==(match=pattern.exec(content.innerHTML));)usedFiles[decodeURIComponent(match[1])]=!0;return usedFiles}(),unusedFiles=function(allFiles,usedFiles){var key,list=[];for(key in allFiles)usedFiles[key]||list.push(key);return list}(_files,usedFiles),missingFiles=function(allFiles,usedFiles){var key,list=[];for(key in usedFiles)allFiles[key]||list.push(key);return list}(_files,usedFiles),i=null;if(form&&window.parent)if(unusedFiles.length>0?(form.querySelectorAll('input[type=checkbox][name^="deletefile"]').forEach((function(node){-1===unusedFiles.indexOf(node.getAttribute("data-filename"))&&node.closest(SELECTORS_FILEANCESTOR).remove()})),form.classList.add(CSS_HASUNUSEDFILES)):form.classList.remove(CSS_HASUNUSEDFILES),missingFiles.length>0){for(_readOnlyError("missingFilesTxt"),_readOnlyError("i");i<missingFiles.length;_readOnlyError("i"))"<li> + ".concat(missingFiles[i].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")," + </li>"),_readOnlyError("missingFilesTxt");_readOnlyError("missingFilesTxt"),form.querySelector(SELECTORS_MISSINGFILES).innerHTML=null,form.classList.add(CSS_HASMISSINGFILES)}else form.classList.remove(CSS_HASMISSINGFILES);else window.console.log("Unable to find parent window")}(files,usercontext,itemid)}}));

//# sourceMappingURL=usedfiles.min.js.map