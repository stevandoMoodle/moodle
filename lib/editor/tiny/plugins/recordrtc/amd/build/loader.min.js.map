{"version":3,"file":"loader.min.js","sources":["../src/loader.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tiny Record RTC plugin class for Moodle.\n *\n * @module      tiny_recordrtc/loader\n * @copyright   2022, Stevani Andolo <stevani@hotmail.com.au>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {get_string as getString} from 'core/str';\nimport * as Modal from 'core/modal_factory';\nimport * as ModalEvents from 'core/modal_events';\nimport {getData} from './options';\nimport Templates from 'core/templates';\nimport {component} from './common';\nimport * as AudioModule from './recording/audiomodule';\nimport * as VideoModule from './recording/videomodule';\nimport * as CommonModule from './recording/commonmodule';\n\nexport const Loader = class {\n\n    editor = null;\n    contextid = null;\n    sesskey = null;\n    allowedtypes = null;\n    audiobitrate = null;\n    videobitrate = null;\n    audiotimelimit = null;\n    videotimelimit = null;\n    defaulttimelimit = null;\n    maxrecsize = null;\n    filepickeroptions = null;\n    currentModal = null;\n\n    constructor(editor) {\n        const data = getData(editor);\n        this.editor = editor;\n        this.contextid = data.params.contextid;\n        this.sesskey = data.params.sesskey;\n        this.allowedtypes = data.params.allowedtypes;\n        this.audiobitrate = data.params.audiobitrate;\n        this.videobitrate = data.params.videobitrate;\n        this.audiotimelimit = data.params.audiotimelimit;\n        this.videotimelimit = data.params.videotimelimit;\n        this.defaulttimelimit = data.params.defaulttimelimit;\n        this.maxrecsize = data.params.maxrecsize;\n        this.filepickeroptions = data.fpoptions;\n    }\n\n    displayAudioDialogue() {\n        Modal.create({\n            type: Modal.types.DEFAULT,\n            large: true,\n            title: getString('audiotitle', component),\n            body: this.createContent('audio')\n        }).then(modal => {\n            this.currentModal = modal;\n            modal.getRoot().on(ModalEvents.hidden, () => {\n                modal.destroy();\n                this.killRecording();\n            });\n            modal.getRoot().on(ModalEvents.bodyRendered, () => {\n                AudioModule.init(this);\n            });\n            modal.show();\n            return modal;\n        }).catch();\n    }\n\n    displayVideoDialogue() {\n        Modal.create({\n            type: Modal.types.DEFAULT,\n            large: true,\n            title: getString('videotitle', component),\n            body: this.createContent('video')\n        }).then(modal => {\n            this.currentModal = modal;\n            modal.getRoot().on(ModalEvents.hidden, () => {\n                modal.destroy();\n                this.killRecording();\n            });\n            modal.getRoot().on(ModalEvents.bodyRendered, () => {\n                VideoModule.init(this);\n            });\n            modal.show();\n            return modal;\n        }).catch();\n    }\n\n    createContent(rtctype) {\n        return Templates.render('tiny_recordrtc/insert_recording', {\n            PLUGINNAME: component,\n            isaudio: (rtctype === 'audio'),\n            bsrow: 'row',\n            bscol: 'col-',\n            bsaldang: 'alert-danger',\n            bsssbtn: 'btn btn-lg btn-outline-danger btn-block'\n        });\n    }\n\n    killRecording() {\n        window.clearInterval(CommonModule.data.countdownTicker);\n\n        if (CommonModule.data.mediaRecorder && CommonModule.data.mediaRecorder.state !== 'inactive') {\n            CommonModule.data.mediaRecorder.stop();\n        }\n\n        if (CommonModule.data.stream) {\n            CommonModule.data.stream.getTracks().forEach(function(track) {\n                if (track.readyState !== 'ended') {\n                    track.stop();\n                }\n            });\n        }\n    }\n};\n"],"names":["Loader","editor","data","contextid","params","sesskey","allowedtypes","audiobitrate","videobitrate","audiotimelimit","videotimelimit","defaulttimelimit","maxrecsize","filepickeroptions","fpoptions","Modal","create","type","types","DEFAULT","large","title","component","body","this","createContent","then","modal","_this","currentModal","getRoot","on","ModalEvents","hidden","destroy","killRecording","bodyRendered","AudioModule","init","show","catch","_this2","VideoModule","rtctype","Templates","render","PLUGINNAME","isaudio","bsrow","bscol","bsaldang","bsssbtn","window","clearInterval","CommonModule","countdownTicker","mediaRecorder","state","stop","stream","getTracks","forEach","track","readyState"],"mappings":"k0EAiCaA,kCAeGC,mLAbH,uCACG,qCACF,0CACK,0CACA,0CACA,4CACE,4CACA,8CACE,wCACN,+CACO,0CACL,UAGLC,MAAO,oBAAQD,aAChBA,OAASA,YACTE,UAAYD,KAAKE,OAAOD,eACxBE,QAAUH,KAAKE,OAAOC,aACtBC,aAAeJ,KAAKE,OAAOE,kBAC3BC,aAAeL,KAAKE,OAAOG,kBAC3BC,aAAeN,KAAKE,OAAOI,kBAC3BC,eAAiBP,KAAKE,OAAOK,oBAC7BC,eAAiBR,KAAKE,OAAOM,oBAC7BC,iBAAmBT,KAAKE,OAAOO,sBAC/BC,WAAaV,KAAKE,OAAOQ,gBACzBC,kBAAoBX,KAAKY,0HAGlC,0BACIC,MAAMC,OAAO,CACTC,KAAMF,MAAMG,MAAMC,QAClBC,OAAO,EACPC,OAAO,mBAAU,aAAcC,mBAC/BC,KAAMC,KAAKC,cAAc,WAC1BC,MAAK,SAAAC,cACJC,MAAKC,aAAeF,MACpBA,MAAMG,UAAUC,GAAGC,YAAYC,QAAQ,WACnCN,MAAMO,UACNN,MAAKO,mBAETR,MAAMG,UAAUC,GAAGC,YAAYI,cAAc,WACzCC,YAAYC,KAAKV,UAErBD,MAAMY,OACCZ,SACRa,4CAGP,2BACIzB,MAAMC,OAAO,CACTC,KAAMF,MAAMG,MAAMC,QAClBC,OAAO,EACPC,OAAO,mBAAU,aAAcC,mBAC/BC,KAAMC,KAAKC,cAAc,WAC1BC,MAAK,SAAAC,cACJc,OAAKZ,aAAeF,MACpBA,MAAMG,UAAUC,GAAGC,YAAYC,QAAQ,WACnCN,MAAMO,UACNO,OAAKN,mBAETR,MAAMG,UAAUC,GAAGC,YAAYI,cAAc,WACzCM,YAAYJ,KAAKG,WAErBd,MAAMY,OACCZ,SACRa,qCAGP,SAAcG,gBACHC,mBAAUC,OAAO,kCAAmC,CACvDC,WAAYxB,kBACZyB,QAAsB,UAAZJ,QACVK,MAAO,MACPC,MAAO,OACPC,SAAU,eACVC,QAAS,yEAIjB,WACIC,OAAOC,cAAcC,aAAapD,KAAKqD,iBAEnCD,aAAapD,KAAKsD,eAA2D,aAA1CF,aAAapD,KAAKsD,cAAcC,OACnEH,aAAapD,KAAKsD,cAAcE,OAGhCJ,aAAapD,KAAKyD,QAClBL,aAAapD,KAAKyD,OAAOC,YAAYC,SAAQ,SAASC,OACzB,UAArBA,MAAMC,YACND,MAAMJ"}