{"version":3,"file":"abstractmodule.min.js","sources":["../../src/recording/abstractmodule.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n//\n\n/**\n * Tiny Record RTC abstractmodule.\n *\n * @module      tiny_recordrtc/abstractmodule\n * @copyright   2022 Stevani Andolo <stevani@hotmail.com.au>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {get_string as getString} from 'core/str';\nimport * as Modal from 'core/modal_factory';\nimport * as ModalEvents from 'core/modal_events';\nimport {component} from '../common';\nimport * as CommonModule from './commonmodule';\n\n// A helper for making a Moodle alert appear.\n// Subject is the content of the alert (which error ther alert is for).\n// Possibility to add on-alert-close event.\nexport const showAlert = (subject, commonConfig) => {\n    window.console.log(commonConfig);\n    Modal.create({\n        type: Modal.types.DEFAULT,\n        title: getString(subject + '_title', component),\n        body: getString(subject, component)\n    }).then(modal => {\n        modal.getRoot().on(ModalEvents.hidden, () => {\n            modal.destroy();\n        });\n        modal.show();\n        return modal;\n    }).catch();\n};\n\n// Handle getUserMedia errors.\nexport const handleGumErrors = (error, commonConfig) => {\n    // Changes 'CertainError' -> 'gumcertain' to match language string names.\n    var stringName = 'gum' + error.name.replace('Error', '').toLowerCase();\n\n    // After alert, proceed to treat as stopped recording, or close dialogue.\n    if (stringName !== 'gumsecurity') {\n        showAlert(stringName, commonConfig);\n    } else {\n        showAlert(stringName, commonConfig);\n    }\n};\n\n// Select best options for the recording codec.\nexport let selectRecOptions = (recType) => {\n    var types, options;\n\n    if (recType === 'audio') {\n        types = [\n            'audio/webm;codecs=opus',\n            'audio/ogg;codecs=opus'\n        ];\n        options = {\n            audioBitsPerSecond: window.parseInt(CommonModule.data.editorScope.audiobitrate)\n        };\n    } else {\n        types = [\n            'video/webm;codecs=vp9,opus',\n            'video/webm;codecs=h264,opus',\n            'video/webm;codecs=vp8,opus'\n        ];\n        options = {\n            audioBitsPerSecond: window.parseInt(CommonModule.data.editorScope.audiobitrate),\n            videoBitsPerSecond: window.parseInt(CommonModule.data.editorScope.videobitrate)\n        };\n    }\n\n    var compatTypes = types.filter(function(type) {\n        return window.MediaRecorder.isTypeSupported(type);\n    });\n\n    if (compatTypes.length !== 0) {\n        options.mimeType = compatTypes[0];\n    }\n\n    return options;\n};\n"],"names":["showAlert","subject","commonConfig","window","console","log","Modal","create","type","types","DEFAULT","title","component","body","then","modal","getRoot","on","ModalEvents","hidden","destroy","show","catch","error","stringName","name","replace","toLowerCase","recType","options","audioBitsPerSecond","parseInt","CommonModule","data","editorScope","audiobitrate","videoBitsPerSecond","videobitrate","compatTypes","filter","MediaRecorder","isTypeSupported","length","mimeType"],"mappings":";;;;;;;uRAiCaA,UAAY,SAACC,QAASC,cAC/BC,OAAOC,QAAQC,IAAIH,cACnBI,MAAMC,OAAO,CACTC,KAAMF,MAAMG,MAAMC,QAClBC,OAAO,mBAAUV,QAAU,SAAUW,mBACrCC,MAAM,mBAAUZ,QAASW,qBAC1BE,MAAK,SAAAC,cACJA,MAAMC,UAAUC,GAAGC,YAAYC,QAAQ,WACnCJ,MAAMK,aAEVL,MAAMM,OACCN,SACRO,+DAIwB,SAACC,MAAOrB,kBAE/BsB,WAAa,MAAQD,MAAME,KAAKC,QAAQ,QAAS,IAAIC,cAIrD3B,UAAUwB,WAAYtB,yCAOA,SAAC0B,aACvBnB,MAAOoB,QAEK,UAAZD,SACAnB,MAAQ,CACJ,yBACA,yBAEJoB,QAAU,CACNC,mBAAoB3B,OAAO4B,SAASC,aAAaC,KAAKC,YAAYC,iBAGtE1B,MAAQ,CACJ,6BACA,8BACA,8BAEJoB,QAAU,CACNC,mBAAoB3B,OAAO4B,SAASC,aAAaC,KAAKC,YAAYC,cAClEC,mBAAoBjC,OAAO4B,SAASC,aAAaC,KAAKC,YAAYG,oBAItEC,YAAc7B,MAAM8B,QAAO,SAAS/B,aAC7BL,OAAOqC,cAAcC,gBAAgBjC,gBAGrB,IAAvB8B,YAAYI,SACZb,QAAQc,SAAWL,YAAY,IAG5BT"}