{"version":3,"file":"message_drawer.min.js","sources":["../src/message_drawer.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Controls the message drawer.\n *\n * @module     core_message/message_drawer\n * @copyright  2018 Ryan Wyllie <ryan@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(\n[\n    'jquery',\n    'core/custom_interaction_events',\n    'core/pubsub',\n    'core_message/message_drawer_view_contact',\n    'core_message/message_drawer_view_contacts',\n    'core_message/message_drawer_view_conversation',\n    'core_message/message_drawer_view_group_info',\n    'core_message/message_drawer_view_overview',\n    'core_message/message_drawer_view_search',\n    'core_message/message_drawer_view_settings',\n    'core_message/message_drawer_router',\n    'core_message/message_drawer_routes',\n    'core_message/message_drawer_events',\n    'core_message/message_drawer_helper',\n    'core/pending',\n    'core/drawer',\n],\nfunction(\n    $,\n    CustomEvents,\n    PubSub,\n    ViewContact,\n    ViewContacts,\n    ViewConversation,\n    ViewGroupInfo,\n    ViewOverview,\n    ViewSearch,\n    ViewSettings,\n    Router,\n    Routes,\n    Events,\n    Helper,\n    Pending,\n    Drawer\n) {\n\n    var SELECTORS = {\n        POPOVER: '[data-region=\"message-popover-region\"]',\n        JUMPTO: '.popover-region [data-region=\"jumpto\"]',\n        PANEL_BODY_CONTAINER: '[data-region=\"panel-body-container\"]',\n        PANEL_HEADER_CONTAINER: '[data-region=\"panel-header-container\"]',\n        VIEW_CONTACT: '[data-region=\"view-contact\"]',\n        VIEW_CONTACTS: '[data-region=\"view-contacts\"]',\n        VIEW_CONVERSATION: '[data-region=\"view-conversation\"]',\n        VIEW_GROUP_INFO: '[data-region=\"view-group-info\"]',\n        VIEW_OVERVIEW: '[data-region=\"view-overview\"]',\n        VIEW_SEARCH: '[data-region=\"view-search\"]',\n        VIEW_SETTINGS: '[data-region=\"view-settings\"]',\n        ROUTES: '[data-route]',\n        ROUTES_BACK: '[data-route-back]',\n        HEADER_CONTAINER: '[data-region=\"header-container\"]',\n        BODY_CONTAINER: '[data-region=\"body-container\"]',\n        FOOTER_CONTAINER: '[data-region=\"footer-container\"]',\n        MESSAGE_POPOVER_REGION: '[data-region=\"message-popover-region\"]',\n        POPOVER_REGION_MESSAGES: '[data-region=\"popover-region-messages\"]',\n        SEARCH_INPUT: '[data-region=\"view-overview-search-input\"]',\n        MESSAGE_TOGGLE: '.popover-region-toggle',\n        MESSAGE_USER_BUTTON: document.querySelector('#message-user-button'),\n    };\n\n    // Whether the message user button is pressed or not.\n    let MESSAGE_USER_BUTTON_PRESSED = false;\n\n    /**\n     * Get elements for route.\n     *\n     * @param {String} namespace Unique identifier for the Routes\n     * @param {Object} root The message drawer container.\n     * @param {string} selector The route container.\n     *\n     * @return {array} elements Found route container objects.\n     */\n    var getParametersForRoute = function(namespace, root, selector) {\n\n        var header = root.find(SELECTORS.HEADER_CONTAINER).find(selector);\n        if (!header.length) {\n            header = root.find(SELECTORS.PANEL_HEADER_CONTAINER).find(selector);\n        }\n        var body = root.find(SELECTORS.BODY_CONTAINER).find(selector);\n        if (!body.length) {\n            body = root.find(SELECTORS.PANEL_BODY_CONTAINER).find(selector);\n        }\n        var footer = root.find(SELECTORS.FOOTER_CONTAINER).find(selector);\n\n        return [\n            namespace,\n            header.length ? header : null,\n            body.length ? body : null,\n            footer.length ? footer : null\n        ];\n    };\n\n    var routes = [\n        [Routes.VIEW_CONTACT, SELECTORS.VIEW_CONTACT, ViewContact.show, ViewContact.description],\n        [Routes.VIEW_CONTACTS, SELECTORS.VIEW_CONTACTS, ViewContacts.show, ViewContacts.description],\n        [Routes.VIEW_CONVERSATION, SELECTORS.VIEW_CONVERSATION, ViewConversation.show, ViewConversation.description],\n        [Routes.VIEW_GROUP_INFO, SELECTORS.VIEW_GROUP_INFO, ViewGroupInfo.show, ViewGroupInfo.description],\n        [Routes.VIEW_OVERVIEW, SELECTORS.VIEW_OVERVIEW, ViewOverview.show, ViewOverview.description],\n        [Routes.VIEW_SEARCH, SELECTORS.VIEW_SEARCH, ViewSearch.show, ViewSearch.description],\n        [Routes.VIEW_SETTINGS, SELECTORS.VIEW_SETTINGS, ViewSettings.show, ViewSettings.description]\n    ];\n\n    /**\n     * Create routes.\n     *\n     * @param {String} namespace Unique identifier for the Routes\n     * @param {Object} root The message drawer container.\n     */\n    var createRoutes = function(namespace, root) {\n        routes.forEach(function(route) {\n            Router.add(namespace, route[0], getParametersForRoute(namespace, root, route[1]), route[2], route[3]);\n        });\n    };\n\n    /**\n     * Find the root element of the popover based on the using the popover content root's ID.\n     *\n     * @param {Object} contentRoot The popover content's root element.\n     * @returns {jQuery}\n     */\n    const getPopoverRoot = (contentRoot) => {\n        return contentRoot.closest(SELECTORS.MESSAGE_POPOVER_REGION);\n    };\n\n    /**\n     * Show the message drawer.\n     *\n     * @param {string} namespace The route namespace.\n     * @param {Object} root The message drawer container.\n     * @param {HTMLElement} messagePopover Message popover html.\n     */\n    const show = function(namespace, root, messagePopover) {\n        if (!root.attr('data-shown')) {\n            Router.go(namespace, Routes.VIEW_OVERVIEW);\n            root.attr('data-shown', true);\n        }\n\n        const drawerRoot = getPopoverRoot(root);\n        if (drawerRoot.length) {\n            Drawer.show(drawerRoot);\n            messagePopover?.classList.remove('collapsed');\n        }\n\n        // Check if the message user button is pressed.\n        if (MESSAGE_USER_BUTTON_PRESSED) {\n            // Remove the \"active\" class if message user button has it.\n            SELECTORS.MESSAGE_USER_BUTTON?.classList.add('active');\n        }\n    };\n\n    /**\n     * Hide the message drawer.\n     *\n     * @param {Object} root The message drawer container.\n     * @param {HTMLElement} messagePopover Message popover html.\n     */\n    const hide = function(root, messagePopover) {\n        const drawerRoot = getPopoverRoot(root);\n        if (drawerRoot.length) {\n            Drawer.hide(drawerRoot);\n            messagePopover?.classList.add('collapsed');\n\n            // Remove \"active\" class if message user button label has it.\n            if (SELECTORS.MESSAGE_USER_BUTTON) {\n                const messageUserButton = SELECTORS.MESSAGE_USER_BUTTON.querySelector('span.header-button-title');\n                messageUserButton?.classList.remove('active');\n            }\n\n            // Check if the message user button is pressed.\n            if (MESSAGE_USER_BUTTON_PRESSED) {\n                // Remove the \"active\" class if message user button has it.\n                SELECTORS.MESSAGE_USER_BUTTON?.classList.remove('active');\n                // Set the next sibling (span.data-region=\"jumpto\") of message user button tabindex to -1.\n                SELECTORS.MESSAGE_USER_BUTTON.nextSibling.setAttribute('tabindex', -1);\n                // Set MESSAGE_USER_BUTTON_PRESSED back to false.\n                MESSAGE_USER_BUTTON_PRESSED = false;\n            }\n        }\n    };\n\n    /**\n     * Check if the drawer is visible.\n     *\n     * @param {Object} root The message drawer container.\n     * @return {boolean}\n     */\n    var isVisible = function(root) {\n        const drawerRoot = getPopoverRoot(root);\n        if (drawerRoot.length) {\n            return Drawer.isVisible(drawerRoot);\n        }\n        return true;\n    };\n\n    /**\n     * Set Jump from button\n     *\n     * @param {String} buttonid The originating button id\n     */\n    var setJumpFrom = function(buttonid) {\n        document.querySelector(SELECTORS.POPOVER).setAttribute('data-origin', buttonid);\n    };\n\n    /**\n     * Listen to and handle events for routing, showing and hiding the message drawer.\n     *\n     * @param {string} namespace The route namespace.\n     * @param {Object} root The message drawer container.\n     * @param {bool} alwaysVisible Is this messaging app always shown?\n     */\n    var registerEventListeners = function(namespace, root, alwaysVisible) {\n        CustomEvents.define(root, [CustomEvents.events.activate]);\n        var paramRegex = /^data-route-param-?(\\d*)$/;\n\n        root.on(CustomEvents.events.activate, SELECTORS.ROUTES, function(e, data) {\n            var element = $(e.target).closest(SELECTORS.ROUTES);\n            var route = element.attr('data-route');\n            var attributes = [];\n\n            for (var i = 0; i < element[0].attributes.length; i++) {\n                attributes.push(element[0].attributes[i]);\n            }\n\n            var paramAttributes = attributes.filter(function(attribute) {\n                var name = attribute.nodeName;\n                var match = paramRegex.test(name);\n                return match;\n            });\n            paramAttributes.sort(function(a, b) {\n                var aParts = paramRegex.exec(a.nodeName);\n                var bParts = paramRegex.exec(b.nodeName);\n                var aIndex = aParts.length > 1 ? aParts[1] : 0;\n                var bIndex = bParts.length > 1 ? bParts[1] : 0;\n\n                if (aIndex < bIndex) {\n                    return -1;\n                } else if (bIndex < aIndex) {\n                    return 1;\n                } else {\n                    return 0;\n                }\n            });\n\n            var params = paramAttributes.map(function(attribute) {\n                return attribute.nodeValue;\n            });\n\n            var routeParams = [namespace, route].concat(params);\n\n            Router.go.apply(null, routeParams);\n\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ROUTES_BACK, function(e, data) {\n            Router.back(namespace);\n\n            data.originalEvent.preventDefault();\n        });\n\n        // These are theme-specific to help us fix random behat fails.\n        // These events target those events defined in BS3 and BS4 onwards.\n        root.on('hide.bs.collapse', '.collapse', function(e) {\n            var pendingPromise = new Pending();\n            $(e.target).one('hidden.bs.collapse', function() {\n                pendingPromise.resolve();\n            });\n        });\n\n        root.on('show.bs.collapse', '.collapse', function(e) {\n            var pendingPromise = new Pending();\n            $(e.target).one('shown.bs.collapse', function() {\n                pendingPromise.resolve();\n            });\n        });\n\n        $(SELECTORS.JUMPTO).focus(function() {\n            // Get unfocused search container.\n            const overviewSearch = document.querySelector(SELECTORS.VIEW_OVERVIEW);\n            // Check if the search container has class \"hidden\".\n            if (overviewSearch.classList.contains('hidden')) {\n                // Get header container's nodes to loop.\n                const containers = document.querySelector(SELECTORS.HEADER_CONTAINER).childNodes;\n                containers.forEach(container => {\n                    // Check if the container is not \"#text\" and has no class \"hidden\".\n                    if (container.nodeName !== '#text' && !container.classList.contains('hidden')) {\n                        // Set the focus on the \"back\" of the container that has no class \"hidden\".\n                        container.querySelector(SELECTORS.ROUTES_BACK).focus();\n                    }\n                });\n            } else {\n                // Get and check for unfocused search input.\n                const firstInput = root.find(SELECTORS.SEARCH_INPUT);\n                if (firstInput.length) {\n                    // Set the focus on the unfocused search input if its container has no class \"hidden\".\n                    firstInput.focus();\n                }\n            }\n        });\n\n        $(SELECTORS.POPOVER).focus(function() {\n            var button = $(this).attr('data-origin');\n            if (button) {\n                $('#' + button).focus();\n            }\n        });\n\n        if (!alwaysVisible) {\n            PubSub.subscribe(Events.SHOW, function() {\n                show(namespace, root);\n            });\n\n            PubSub.subscribe(Events.HIDE, function() {\n                hide(root);\n            });\n\n            PubSub.subscribe(Events.TOGGLE_VISIBILITY, function(buttonid) {\n                const messagePopover = document.getElementById(buttonid).parentElement;\n                if (isVisible(root)) {\n                    hide(root, messagePopover);\n                    $(SELECTORS.JUMPTO).attr('tabindex', -1);\n                } else {\n                    show(namespace, root, messagePopover);\n                    setJumpFrom(buttonid);\n                    $(SELECTORS.JUMPTO).attr('tabindex', 0);\n                }\n            });\n\n            // Keydown to track if a dropdown menu within the message popover is focused.\n            let isExpanded = false;\n            document.addEventListener('keydown', async(e) => {\n                if (e.key === \"Escape\") {\n                    if (e.target.dataset.toggle) {\n                        isExpanded = e.target.getAttribute('aria-expanded') === 'false' ? false : true;\n                    } else {\n                        if (e.target.parentElement.classList.contains('dropdown-menu')) {\n                            isExpanded = true;\n                        }\n                    }\n                }\n            });\n\n            // Keyup to close the message popover if escape is pressed and the current focused element\n            // is not a dropdown within the message popover.\n            document.addEventListener('keyup', async(e) => {\n                if (e.key === \"Escape\") {\n                    if (!isExpanded) {\n                        const messagePopover = document.querySelector(SELECTORS.POPOVER_REGION_MESSAGES);\n                        if (messagePopover && isVisible(root)) {\n                            // Set the focus back to body.\n                            document.activeElement.blur();\n                            // Set jumpto tabindex back to -1.\n                            document.querySelector(SELECTORS.JUMPTO).setAttribute('tabindex', -1);\n\n                            // Check if the message user button is pressed.\n                            if (MESSAGE_USER_BUTTON_PRESSED) {\n                                SELECTORS.MESSAGE_USER_BUTTON.focus();\n                            } else {\n                                // Set the fucus to message icon in the header.\n                                document.querySelector(`${SELECTORS.POPOVER_REGION_MESSAGES} ${SELECTORS.MESSAGE_TOGGLE}`).focus();\n                            }\n                            hide(root, messagePopover);\n                        }\n                    }\n                }\n            });\n\n            // Close the popover if clicked outside of it.\n            document.addEventListener('click', (e) => {\n                const target = e.target;\n                const messagePopover = document.querySelector(SELECTORS.POPOVER_REGION_MESSAGES);\n                const messageUserButton = SELECTORS.MESSAGE_USER_BUTTON;\n                if (messagePopover) {\n                    // Get the underlying DOM element(s) from the jQuery object.\n                    const rootElement = root[0];\n                    if (rootElement !== target && !rootElement?.contains(target) &&\n                        messagePopover !== target && !messagePopover?.contains(target) &&\n                        messageUserButton !== target && !messageUserButton?.contains(target)) {\n                        hide(root, messagePopover);\n                    }\n                }\n            });\n        }\n\n        PubSub.subscribe(Events.SHOW_CONVERSATION, function(args) {\n            MESSAGE_USER_BUTTON_PRESSED = true;\n            setJumpFrom(args.buttonid);\n            show(namespace, root);\n            Router.go(namespace, Routes.VIEW_CONVERSATION, args.conversationid);\n        });\n\n        PubSub.subscribe(Events.CREATE_CONVERSATION_WITH_USER, async function(args) {\n            MESSAGE_USER_BUTTON_PRESSED = true;\n            setJumpFrom(args.buttonid);\n            show(namespace, root);\n            Router.go(namespace, Routes.VIEW_CONVERSATION, null, 'create', args.userid);\n        });\n\n        PubSub.subscribe(Events.SHOW_SETTINGS, function() {\n            show(namespace, root);\n            Router.go(namespace, Routes.VIEW_SETTINGS);\n        });\n\n        PubSub.subscribe(Events.PREFERENCES_UPDATED, function(preferences) {\n            var filteredPreferences = preferences.filter(function(preference) {\n                return preference.type == 'message_entertosend';\n            });\n            var enterToSendPreference = filteredPreferences.length ? filteredPreferences[0] : null;\n\n            if (enterToSendPreference) {\n                var viewConversationFooter = root.find(SELECTORS.FOOTER_CONTAINER).find(SELECTORS.VIEW_CONVERSATION);\n                viewConversationFooter.attr('data-enter-to-send', enterToSendPreference.value);\n            }\n        });\n    };\n\n    /**\n     * Initialise the message drawer.\n     *\n     * @param {Object} root The message drawer container.\n     * @param {String} uniqueId Unique identifier for the Routes\n     * @param {bool} alwaysVisible Should we show the app now, or wait for the user?\n     * @param {Object} route\n     */\n    var init = function(root, uniqueId, alwaysVisible, route) {\n        root = $(root);\n        createRoutes(uniqueId, root);\n        registerEventListeners(uniqueId, root, alwaysVisible);\n\n        if (alwaysVisible) {\n            show(uniqueId, root);\n\n            if (route) {\n                var routeParams = route.params || [];\n                routeParams = [uniqueId, route.path].concat(routeParams);\n                Router.go.apply(null, routeParams);\n            }\n        }\n\n        // Mark the drawer as ready.\n        Helper.markDrawerReady();\n    };\n\n    return {\n        init: init,\n    };\n});\n"],"names":["define","$","CustomEvents","PubSub","ViewContact","ViewContacts","ViewConversation","ViewGroupInfo","ViewOverview","ViewSearch","ViewSettings","Router","Routes","Events","Helper","Pending","Drawer","SELECTORS","POPOVER","JUMPTO","PANEL_BODY_CONTAINER","PANEL_HEADER_CONTAINER","VIEW_CONTACT","VIEW_CONTACTS","VIEW_CONVERSATION","VIEW_GROUP_INFO","VIEW_OVERVIEW","VIEW_SEARCH","VIEW_SETTINGS","ROUTES","ROUTES_BACK","HEADER_CONTAINER","BODY_CONTAINER","FOOTER_CONTAINER","MESSAGE_POPOVER_REGION","POPOVER_REGION_MESSAGES","SEARCH_INPUT","MESSAGE_TOGGLE","MESSAGE_USER_BUTTON","document","querySelector","MESSAGE_USER_BUTTON_PRESSED","routes","show","description","createRoutes","namespace","root","forEach","route","add","selector","header","find","length","body","footer","getParametersForRoute","getPopoverRoot","contentRoot","closest","messagePopover","attr","go","drawerRoot","classList","remove","hide","messageUserButton","nextSibling","setAttribute","isVisible","setJumpFrom","buttonid","init","uniqueId","alwaysVisible","events","activate","paramRegex","on","e","data","element","target","attributes","i","push","paramAttributes","filter","attribute","name","nodeName","test","sort","a","b","aParts","exec","bParts","aIndex","bIndex","params","map","nodeValue","routeParams","concat","apply","originalEvent","preventDefault","back","pendingPromise","one","resolve","focus","contains","childNodes","container","firstInput","button","this","subscribe","SHOW","HIDE","TOGGLE_VISIBILITY","getElementById","parentElement","isExpanded","addEventListener","async","key","dataset","toggle","getAttribute","activeElement","blur","rootElement","SHOW_CONVERSATION","args","conversationid","CREATE_CONVERSATION_WITH_USER","userid","SHOW_SETTINGS","PREFERENCES_UPDATED","preferences","filteredPreferences","preference","type","enterToSendPreference","value","registerEventListeners","path","markDrawerReady"],"mappings":"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"}