define("tool_componentlibrary/search",["exports","tool_componentlibrary/lunr","tool_componentlibrary/selectors","core/log","core/notification","core/key_codes"],(function(_exports,_lunr,_selectors,_log,_notification,_key_codes){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.search=void 0,_lunr=_interopRequireDefault(_lunr),_selectors=_interopRequireDefault(_selectors),_log=_interopRequireDefault(_log),_notification=_interopRequireDefault(_notification);var fn,_ref,lunrIndex=null,pagesIndex=null,fetchJson=(fn=regeneratorRuntime.mark((function _callee(jsonFile){var response;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,fetch(jsonFile);case 2:return(response=_context.sent).ok||_log.default.debug("Error getting Hugo index file: ".concat(response.status)),_context.next=6,response.json();case 6:return _context.abrupt("return",_context.sent);case 7:case"end":return _context.stop()}}),_callee)})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x){return _ref.apply(this,arguments)}),searchIndex=function(query){return lunrIndex.search(query+" "+query+"*").map((function(result){return pagesIndex.filter((function(page){return page.uri===result.ref}))[0]}))},renderResults=function(results){var dropdownMenu=document.querySelector(_selectors.default.dropdownmenu);if(results.length){dropdownMenu.innerHTML="";var baseUrl=M.cfg.wwwroot+"/admin/tool/componentlibrary/docspage.php";results.slice(0,10).forEach((function(result){var link=document.createElement("a"),chapter=result.uri.split("/")[1];link.appendChild(document.createTextNode("".concat(chapter," > ").concat(result.title))),link.classList.add("dropdown-item"),link.href=baseUrl+result.uri,dropdownMenu.appendChild(link)})),dropdownMenu.classList.add("show")}else dropdownMenu.classList.remove("show")};_exports.search=function(jsonFile){var searchInput;!function(jsonFile){fetchJson(jsonFile).then((function(jsondata){return pagesIndex=jsondata,lunrIndex=(0,_lunr.default)((function(){var _this=this;this.ref("uri"),this.field("title",{boost:10}),this.field("content"),this.field("tags",{boost:5}),jsondata.forEach((function(p){_this.add(p)}))})),null})).catch(_notification.default.exception)}(jsonFile),(searchInput=document.querySelector(_selectors.default.searchinput)).addEventListener("keyup",(function(e){var query=e.currentTarget.value;query.length<2?document.querySelector(_selectors.default.dropdownmenu).classList.remove("show"):renderResults(searchIndex(query))})),searchInput.addEventListener("keydown",(function(e){e.keyCode===_key_codes.enter&&e.preventDefault(),e.keyCode===_key_codes.escape&&(searchInput.value="")}))}}));

//# sourceMappingURL=search.min.js.map